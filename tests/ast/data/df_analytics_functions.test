## TEST CASE

data = [
    ["2023-01-01", 101, 200],
    ["2023-01-02", 101, 100],
    ["2023-01-03", 101, 300],
    ["2023-01-04", 102, 250],
]

df = session.create_dataframe(data).to_df(
    "ORDERDATE", "PRODUCTKEY", "SALESAMOUNT"
)

df2 = df.with_column("HALF_AMOUNT", df["SALESAMOUNT"] / 2)

moving_agg_res = df.analytics.moving_agg(
    aggs={"SALESAMOUNT": ["SUM", "AVG"]},
    window_sizes=[2, 3],
    order_by=["ORDERDATE"],
    group_by=["PRODUCTKEY"],
)

moving_agg_res2 = df2.analytics.moving_agg(
    aggs={"SALESAMOUNT": ["SUM"], "HALF_AMOUNT": ["MAX"]},
    window_sizes=[2, 3],
    order_by=["ORDERDATE"],
    group_by=["PRODUCTKEY"],
)

cumulative_agg_res = df.analytics.cumulative_agg(
    aggs={"SALESAMOUNT": ["SUM", "MIN", "MAX"]},
    group_by=["PRODUCTKEY"],
    order_by=["ORDERDATE"],
    is_forward=True
)

compute_lag_res = df.analytics.compute_lag(
    cols=["SALESAMOUNT"],
    lags=[1, 2],
    order_by=["ORDERDATE"],
    group_by=["PRODUCTKEY"],
)

compute_lead_res = df.analytics.compute_lead(
    cols=["SALESAMOUNT"],
    leads=[1, 2],
    order_by=["ORDERDATE"],
    group_by=["PRODUCTKEY"],
)

df = df.with_column("ORDERDATE", to_timestamp(df["ORDERDATE"]))

def custom_formatter(input_col, agg, window):
    return f"{agg}_{input_col}_{window}"

time_series_agg_res = df.analytics.time_series_agg(
    time_col="ORDERDATE",
    aggs={"SALESAMOUNT": ["SUM", "MAX"]},
    windows=["1D", "-1D"],
    group_by=["PRODUCTKEY"],
    sliding_interval="12H",
    col_formatter=custom_formatter,
)

## EXPECTED UNPARSER OUTPUT

df = session.create_dataframe([["2023-01-01", 101, 200], ["2023-01-02", 101, 100], ["2023-01-03", 101, 300], ["2023-01-04", 102, 250]])

df = df.to_df("ORDERDATE", "PRODUCTKEY", "SALESAMOUNT")

df2 = df.with_column("HALF_AMOUNT", df["SALESAMOUNT"] / 2)

moving_agg_res = df.analytics.moving_agg(aggs={"SALESAMOUNT": ["SUM", "AVG"]}, window_sizes=[2, 3], order_by=["ORDERDATE"], group_by=["PRODUCTKEY"], formatted_col_names=["SALESAMOUNT_SUM_2", "SALESAMOUNT_AVG_2", "SALESAMOUNT_SUM_3", "SALESAMOUNT_AVG_3"])

moving_agg_res2 = df2.analytics.moving_agg(aggs={"SALESAMOUNT": ["SUM"], "HALF_AMOUNT": ["MAX"]}, window_sizes=[2, 3], order_by=["ORDERDATE"], group_by=["PRODUCTKEY"], formatted_col_names=["SALESAMOUNT_SUM_2", "SALESAMOUNT_SUM_3", "HALF_AMOUNT_MAX_2", "HALF_AMOUNT_MAX_3"])

cumulative_agg_res = df.analytics.cumulative_agg(aggs={"SALESAMOUNT": ["SUM", "MIN", "MAX"]}, order_by=["ORDERDATE"], group_by=["PRODUCTKEY"], is_forward=True, formatted_col_names=["SALESAMOUNT_SUM", "SALESAMOUNT_MIN", "SALESAMOUNT_MAX"])

compute_lag_res = df.analytics.compute_lag(cols=["SALESAMOUNT"], lags=[1, 2], order_by=["ORDERDATE"], group_by=["PRODUCTKEY"], formatted_col_names=["SALESAMOUNT_LAG_1", "SALESAMOUNT_LAG_2"])

compute_lead_res = df.analytics.compute_lead(cols=["SALESAMOUNT"], leads=[1, 2], order_by=["ORDERDATE"], group_by=["PRODUCTKEY"], formatted_col_names=["SALESAMOUNT_LEAD_1", "SALESAMOUNT_LEAD_2"])

df = df.with_column("ORDERDATE", to_timestamp(df["ORDERDATE"]))

time_series_agg_res = df.analytics.time_series_agg(time_col="ORDERDATE", aggs={"SALESAMOUNT": ["SUM", "MAX"]}, windows=["1D", "-1D"], group_by=["PRODUCTKEY"], sliding_interval="12H", formatted_col_names=["SUM_SALESAMOUNT_1D", "MAX_SALESAMOUNT_1D", "SUM_SALESAMOUNT_-1D", "MAX_SALESAMOUNT_-1D"])

## EXPECTED ENCODED AST

<<<<<<< HEAD
CpMFCpAFCoEF+gX9BAreBArbBAqUAdICkAEKGhoWU1JDX1BPU0lUSU9OX1RFU1RfTU9ERShhEiv6DCgKGhoWU1JDX1BPU0lUSU9OX1RFU1RfTU9ERShhEgoyMDIzLTAxLTAxEiHCAh4KGhoWU1JDX1BPU0lUSU9OX1RFU1RfTU9ERShhEGUSIsICHwoaGhZTUkNfUE9TSVRJT05fVEVTVF9NT0RFKGEQyAEKkwHSAo8BChoaFlNSQ19QT1NJVElPTl9URVNUX01PREUoYRIr+gwoChoaFlNSQ19QT1NJVElPTl9URVNUX01PREUoYRIKMjAyMy0wMS0wMhIhwgIeChoaFlNSQ19QT1NJVElPTl9URVNUX01PREUoYRBlEiHCAh4KGhoWU1JDX1BPU0lUSU9OX1RFU1RfTU9ERShhEGQKlAHSApABChoaFlNSQ19QT1NJVElPTl9URVNUX01PREUoYRIr+gwoChoaFlNSQ19QT1NJVElPTl9URVNUX01PREUoYRIKMjAyMy0wMS0wMxIhwgIeChoaFlNSQ19QT1NJVElPTl9URVNUX01PREUoYRBlEiLCAh8KGhoWU1JDX1BPU0lUSU9OX1RFU1RfTU9ERShhEKwCCpQB0gKQAQoaGhZTUkNfUE9TSVRJT05fVEVTVF9NT0RFKGESK/oMKAoaGhZTUkNfUE9TSVRJT05fVEVTVF9NT0RFKGESCjIwMjMtMDEtMDQSIcICHgoaGhZTUkNfUE9TSVRJT05fVEVTVF9NT0RFKGEQZhIiwgIfChoaFlNSQ19QT1NJVElPTl9URVNUX01PREUoYRD6ARoaGhZTUkNfUE9TSVRJT05fVEVTVF9NT0RFKGESBAoCZGYYASICCAEKXgpcCk7KCUsKCU9SREVSREFURQoKUFJPRFVDVEtFWQoLU0FMRVNBTU9VTlQSB4ICBAoCCAEaGhoWU1JDX1BPU0lUSU9OX1RFU1RfTU9ERShhIAESBAoCZGYYAiICCAIKxwEKxAEKqQGqBqUBChcKC1NBTEVTQU1PVU5UEgNTVU0SA0FWRxIHggIECgIIAhoRU0FMRVNBTU9VTlRfU1VNXzIaEVNBTEVTQU1PVU5UX0FWR18yGhFTQUxFU0FNT1VOVF9TVU1fMxoRU0FMRVNBTU9VTlRfQVZHXzMiClBST0RVQ1RLRVkqCU9SREVSREFURTIaGhZTUkNfUE9TSVRJT05fVEVTVF9NT0RFKGU6AgIDEhAKDm1vdmluZ19hZ2dfcmVzGAMiAggDCrUBCrIBCpMBogaPAQocCgtTQUxFU0FNT1VOVBIDU1VNEgNNSU4SA01BWBIHggIECgIIAhoPU0FMRVNBTU9VTlRfU1VNGg9TQUxFU0FNT1VOVF9NSU4aD1NBTEVTQU1PVU5UX01BWCIKUFJPRFVDVEtFWSgBMglPUkRFUkRBVEU6GhoWU1JDX1BPU0lUSU9OX1RFU1RfTU9ERShsEhQKEmN1bXVsYXRpdmVfYWdnX3JlcxgEIgIIBAq3AQq0AQqYAZIGlAEKLPoMKQoaGhZTUkNfUE9TSVRJT05fVEVTVF9NT0RFKHMSC1NBTEVTQU1PVU5UEgeCAgQKAggCGhFTQUxFU0FNT1VOVF9MQUdfMRoRU0FMRVNBTU9VTlRfTEFHXzIiClBST0RVQ1RLRVkqAgECMglPUkRFUkRBVEU6GhoWU1JDX1BPU0lUSU9OX1RFU1RfTU9ERShzEhEKD2NvbXB1dGVfbGFnX3JlcxgFIgIIBQq6AQq3AQqaAZoGlgEKLPoMKQoaGhZTUkNfUE9TSVRJT05fVEVTVF9NT0RFKHoSC1NBTEVTQU1PVU5UEgeCAgQKAggCGhJTQUxFU0FNT1VOVF9MRUFEXzEaElNBTEVTQU1PVU5UX0xFQURfMiIKUFJPRFVDVEtFWSoCAQIyCU9SREVSREFURToaGhZTUkNfUE9TSVRJT05fVEVTVF9NT0RFKHoSEgoQY29tcHV0ZV9sZWFkX3JlcxgGIgIIBgq1AQqyAQqjAZoKnwEKbJIBaQoUGhIKEAoOCgx0b190aW1lc3RhbXAaNMoGMQoJT1JERVJEQVRFEgeCAgQKAggCGhsaFlNSQ19QT1NJVElPTl9URVNUX01PREUogQEiGxoWU1JDX1BPU0lUSU9OX1RFU1RfTU9ERSiBARIJT1JERVJEQVRFGgeCAgQKAggCIhsaFlNSQ19QT1NJVElPTl9URVNUX01PREUogQESBAoCZGYYByICCAcK3QEK2gEKugGyBrYBChcKC1NBTEVTQU1PVU5UEgNTVU0SA01BWBIHggIECgIIBxoSU1VNX1NBTEVTQU1PVU5UXzFEGhJNQVhfU0FMRVNBTU9VTlRfMUQaE1NVTV9TQUxFU0FNT1VOVF8tMUQaE01BWF9TQUxFU0FNT1VOVF8tMUQiClBST0RVQ1RLRVkqAzEySDIbGhZTUkNfUE9TSVRJT05fVEVTVF9NT0RFKIYBOglPUkRFUkRBVEVCAjFEQgMtMUQSFQoTdGltZV9zZXJpZXNfYWdnX3JlcxgIIgIICBABGhESDwoNCgVmaW5hbBADGAkgFCIEEAEYFw==
=======
CpMFCpAFCoEF8gX9BAreBArbBAqUAcoCkAEKGhoWU1JDX1BPU0lUSU9OX1RFU1RfTU9ERShhEiuyDCgKGhoWU1JDX1BPU0lUSU9OX1RFU1RfTU9ERShhEgoyMDIzLTAxLTAxEiG6Ah4KGhoWU1JDX1BPU0lUSU9OX1RFU1RfTU9ERShhEGUSIroCHwoaGhZTUkNfUE9TSVRJT05fVEVTVF9NT0RFKGEQyAEKkwHKAo8BChoaFlNSQ19QT1NJVElPTl9URVNUX01PREUoYRIrsgwoChoaFlNSQ19QT1NJVElPTl9URVNUX01PREUoYRIKMjAyMy0wMS0wMhIhugIeChoaFlNSQ19QT1NJVElPTl9URVNUX01PREUoYRBlEiG6Ah4KGhoWU1JDX1BPU0lUSU9OX1RFU1RfTU9ERShhEGQKlAHKApABChoaFlNSQ19QT1NJVElPTl9URVNUX01PREUoYRIrsgwoChoaFlNSQ19QT1NJVElPTl9URVNUX01PREUoYRIKMjAyMy0wMS0wMxIhugIeChoaFlNSQ19QT1NJVElPTl9URVNUX01PREUoYRBlEiK6Ah8KGhoWU1JDX1BPU0lUSU9OX1RFU1RfTU9ERShhEKwCCpQBygKQAQoaGhZTUkNfUE9TSVRJT05fVEVTVF9NT0RFKGESK7IMKAoaGhZTUkNfUE9TSVRJT05fVEVTVF9NT0RFKGESCjIwMjMtMDEtMDQSIboCHgoaGhZTUkNfUE9TSVRJT05fVEVTVF9NT0RFKGEQZhIiugIfChoaFlNSQ19QT1NJVElPTl9URVNUX01PREUoYRD6ARoaGhZTUkNfUE9TSVRJT05fVEVTVF9NT0RFKGESBAoCZGYYASICCAEKXgpcCk7CCUsKCU9SREVSREFURQoKUFJPRFVDVEtFWQoLU0FMRVNBTU9VTlQSB4ICBAoCCAEaGhoWU1JDX1BPU0lUSU9OX1RFU1RfTU9ERShhIAESBAoCZGYYAiICCAIKxAEKwQEKsQGSCq0BCnnqAXYKNcIGMgoLU0FMRVNBTU9VTlQSB4ICBAoCCAIaGhoWU1JDX1BPU0lUSU9OX1RFU1RfTU9ERShlEiG6Ah4KGhoWU1JDX1BPU0lUSU9OX1RFU1RfTU9ERShlEAIaGhoWU1JDX1BPU0lUSU9OX1RFU1RfTU9ERShlEgtIQUxGX0FNT1VOVBoHggIECgIIAiIaGhZTUkNfUE9TSVRJT05fVEVTVF9NT0RFKGUSBQoDZGYyGAMiAggDCscBCsQBCqkBogalAQoXCgtTQUxFU0FNT1VOVBIDU1VNEgNBVkcSB4ICBAoCCAIaEVNBTEVTQU1PVU5UX1NVTV8yGhFTQUxFU0FNT1VOVF9BVkdfMhoRU0FMRVNBTU9VTlRfU1VNXzMaEVNBTEVTQU1PVU5UX0FWR18zIgpQUk9EVUNUS0VZKglPUkRFUkRBVEUyGhoWU1JDX1BPU0lUSU9OX1RFU1RfTU9ERShnOgICAxIQCg5tb3ZpbmdfYWdnX3JlcxgEIgIIBArXAQrUAQq4AaIGtAEKEgoLU0FMRVNBTU9VTlQSA1NVTQoSCgtIQUxGX0FNT1VOVBIDTUFYEgeCAgQKAggDGhFTQUxFU0FNT1VOVF9TVU1fMhoRU0FMRVNBTU9VTlRfU1VNXzMaEUhBTEZfQU1PVU5UX01BWF8yGhFIQUxGX0FNT1VOVF9NQVhfMyIKUFJPRFVDVEtFWSoJT1JERVJEQVRFMhoaFlNSQ19QT1NJVElPTl9URVNUX01PREUobjoCAgMSEQoPbW92aW5nX2FnZ19yZXMyGAUiAggFCrUBCrIBCpMBmgaPAQocCgtTQUxFU0FNT1VOVBIDU1VNEgNNSU4SA01BWBIHggIECgIIAhoPU0FMRVNBTU9VTlRfU1VNGg9TQUxFU0FNT1VOVF9NSU4aD1NBTEVTQU1PVU5UX01BWCIKUFJPRFVDVEtFWSgBMglPUkRFUkRBVEU6GhoWU1JDX1BPU0lUSU9OX1RFU1RfTU9ERSh1EhQKEmN1bXVsYXRpdmVfYWdnX3JlcxgGIgIIBgq3AQq0AQqYAYoGlAEKLLIMKQoaGhZTUkNfUE9TSVRJT05fVEVTVF9NT0RFKHwSC1NBTEVTQU1PVU5UEgeCAgQKAggCGhFTQUxFU0FNT1VOVF9MQUdfMRoRU0FMRVNBTU9VTlRfTEFHXzIiClBST0RVQ1RLRVkqAgECMglPUkRFUkRBVEU6GhoWU1JDX1BPU0lUSU9OX1RFU1RfTU9ERSh8EhEKD2NvbXB1dGVfbGFnX3JlcxgHIgIIBwq8AQq5AQqcAZIGmAEKLbIMKgobGhZTUkNfUE9TSVRJT05fVEVTVF9NT0RFKIMBEgtTQUxFU0FNT1VOVBIHggIECgIIAhoSU0FMRVNBTU9VTlRfTEVBRF8xGhJTQUxFU0FNT1VOVF9MRUFEXzIiClBST0RVQ1RLRVkqAgECMglPUkRFUkRBVEU6GxoWU1JDX1BPU0lUSU9OX1RFU1RfTU9ERSiDARISChBjb21wdXRlX2xlYWRfcmVzGAgiAggICrUBCrIBCqMBkgqfAQpsigFpChQaEgoQCg4KDHRvX3RpbWVzdGFtcBo0wgYxCglPUkRFUkRBVEUSB4ICBAoCCAIaGxoWU1JDX1BPU0lUSU9OX1RFU1RfTU9ERSiKASIbGhZTUkNfUE9TSVRJT05fVEVTVF9NT0RFKIoBEglPUkRFUkRBVEUaB4ICBAoCCAIiGxoWU1JDX1BPU0lUSU9OX1RFU1RfTU9ERSiKARIECgJkZhgJIgIICQrdAQraAQq6AaoGtgEKFwoLU0FMRVNBTU9VTlQSA1NVTRIDTUFYEgeCAgQKAggJGhJTVU1fU0FMRVNBTU9VTlRfMUQaEk1BWF9TQUxFU0FNT1VOVF8xRBoTU1VNX1NBTEVTQU1PVU5UXy0xRBoTTUFYX1NBTEVTQU1PVU5UXy0xRCIKUFJPRFVDVEtFWSoDMTJIMhsaFlNSQ19QT1NJVElPTl9URVNUX01PREUojwE6CU9SREVSREFURUICMURCAy0xRBIVChN0aW1lX3Nlcmllc19hZ2dfcmVzGAoiAggKEAEaERIPCg0KBWZpbmFsEAMYCSAUIgQQARgX
>>>>>>> 80975ccea (SNOW-1737248 Fix map output in expectation tests)
