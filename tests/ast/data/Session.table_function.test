## TEST CASE

from snowflake.snowpark.functions import sproc

def my_sproc(session: snowflake.snowpark.Session, foo: int, bar: str, baz: bool) -> str:
    return "SUCCESS!"

def my_sproc2(session: snowflake.snowpark.Session, foo: int) -> str:
    return "SUCCESS!"

my_sproc_sp = session.sproc.register(my_sproc, name="my_fn1", replace=True, comment="The parameters are useless.")

my_sproc_sp2 = session.sproc.register(my_sproc, name="my_fn2", replace=True, comment="Hello!")

df1 = session.table_function("my_fn1", lit(1), lit("two"), lit(True))

df2 = session.table_function("my_fn2", lit(20))

df3 = session.table_function(["my_fn1", "my_fn2"])

fn1 = table_function("my_fn1")
df4 = session.table_function(fn1(lit(1), lit("V"), lit(True)))

fn2 = table_function("my_fn2")
df5 = session.table_function(fn2(lit(12)))

fn3 = call_table_function("my_fn1", lit(5), lit("A"), lit(False))
df6 = session.table_function(fn3)

fn4 = call_table_function("my_fn2")
df7 = session.table_function(fn4)

## EXPECTED UNPARSER OUTPUT

my_sproc_sp = sproc("my_sproc", return_type=StringType(), input_types=[LongType(), StringType(), BooleanType()], name="my_fn1", replace=True, comment="The parameters are useless.", _registered_object_name="\"MOCK_DATABASE\".\"MOCK_SCHEMA\".\"MY_FN1\"")

my_sproc_sp2 = sproc("my_sproc", return_type=StringType(), input_types=[LongType(), StringType(), BooleanType()], name="my_fn2", replace=True, comment="Hello!", _registered_object_name="\"MOCK_DATABASE\".\"MOCK_SCHEMA\".\"MY_FN2\"")

df1 = session.table_function("my_fn1", lit(1), lit("two"), lit(True))

df2 = session.table_function("my_fn2", lit(20))

df3 = session.table_function(["my_fn1", "my_fn2"])

df4 = session.table_function(call_table_function("my_fn1", lit(1), lit("V"), lit(True)))

df5 = session.table_function(call_table_function("my_fn2", lit(12)))

df6 = session.table_function(call_table_function("my_fn1", lit(5), lit("A"), lit(False)))

df7 = session.table_function(call_table_function("my_fn2"))

## EXPECTED ENCODED AST

body {
  assign {
    expr {
      stored_procedure {
        comment {
          value: "The parameters are useless."
        }
        execute_as: "owner"
        func {
          name: "my_sproc"
          object_name {
            name {
              sp_name_flat {
                name: "\"MOCK_DATABASE\".\"MOCK_SCHEMA\".\"MY_FN1\""
              }
            }
          }
        }
        input_types {
          list {
            sp_long_type: true
          }
          list {
            sp_string_type {
              length {
              }
            }
          }
          list {
            sp_boolean_type: true
          }
        }
        name {
          name {
            sp_name_flat {
              name: "my_fn1"
            }
          }
        }
        parallel: 4
        replace: true
        return_type {
          sp_string_type {
            length {
            }
          }
        }
        source_code_display: true
        src {
          file: "SRC_POSITION_TEST_MODE"
          start_line: 33
        }
      }
    }
    symbol {
      value: "my_sproc_sp"
    }
    uid: 1
    var_id {
      bitfield1: 1
    }
  }
}
body {
  assign {
    expr {
      stored_procedure {
        comment {
          value: "Hello!"
        }
        execute_as: "owner"
        func {
          name: "my_sproc"
          object_name {
            name {
              sp_name_flat {
                name: "\"MOCK_DATABASE\".\"MOCK_SCHEMA\".\"MY_FN2\""
              }
            }
          }
        }
        input_types {
          list {
            sp_long_type: true
          }
          list {
            sp_string_type {
              length {
              }
            }
          }
          list {
            sp_boolean_type: true
          }
        }
        name {
          name {
            sp_name_flat {
              name: "my_fn2"
            }
          }
        }
        parallel: 4
        replace: true
        return_type {
          sp_string_type {
            length {
            }
          }
        }
        source_code_display: true
        src {
          file: "SRC_POSITION_TEST_MODE"
          start_line: 35
        }
      }
    }
    symbol {
      value: "my_sproc_sp2"
    }
    uid: 2
    var_id {
      bitfield1: 2
    }
  }
}
body {
  assign {
    expr {
      sp_session_table_function {
        fn {
          apply_expr {
            fn {
              indirect_table_fn_name_ref {
                name {
                  name {
                    sp_name_flat {
                      name: "my_fn1"
                    }
                  }
                }
              }
            }
            pos_args {
              apply_expr {
                fn {
                  builtin_fn {
                    name {
                      name {
                        sp_name_flat {
                          name: "lit"
                        }
                      }
                    }
                  }
                }
                pos_args {
                  int64_val {
                    src {
                      file: "SRC_POSITION_TEST_MODE"
                      start_line: 37
                    }
                    v: 1
                  }
                }
                src {
                  file: "SRC_POSITION_TEST_MODE"
                  start_line: 37
                }
              }
            }
            pos_args {
              apply_expr {
                fn {
                  builtin_fn {
                    name {
                      name {
                        sp_name_flat {
                          name: "lit"
                        }
                      }
                    }
                  }
                }
                pos_args {
                  string_val {
                    src {
                      file: "SRC_POSITION_TEST_MODE"
                      start_line: 37
                    }
                    v: "two"
                  }
                }
                src {
                  file: "SRC_POSITION_TEST_MODE"
                  start_line: 37
                }
              }
            }
            pos_args {
              apply_expr {
                fn {
                  builtin_fn {
                    name {
                      name {
                        sp_name_flat {
                          name: "lit"
                        }
                      }
                    }
                  }
                }
                pos_args {
                  bool_val {
                    src {
                      file: "SRC_POSITION_TEST_MODE"
                      start_line: 37
                    }
                    v: true
                  }
                }
                src {
                  file: "SRC_POSITION_TEST_MODE"
                  start_line: 37
                }
              }
            }
            src {
              file: "SRC_POSITION_TEST_MODE"
              start_line: 37
            }
          }
        }
        src {
          file: "SRC_POSITION_TEST_MODE"
          start_line: 37
        }
      }
    }
    symbol {
      value: "df1"
    }
    uid: 3
    var_id {
      bitfield1: 3
    }
  }
}
body {
  assign {
    expr {
      sp_session_table_function {
        fn {
          apply_expr {
            fn {
              indirect_table_fn_name_ref {
                name {
                  name {
                    sp_name_flat {
                      name: "my_fn2"
                    }
                  }
                }
              }
            }
            pos_args {
              apply_expr {
                fn {
                  builtin_fn {
                    name {
                      name {
                        sp_name_flat {
                          name: "lit"
                        }
                      }
                    }
                  }
                }
                pos_args {
                  int64_val {
                    src {
                      file: "SRC_POSITION_TEST_MODE"
                      start_line: 39
                    }
                    v: 20
                  }
                }
                src {
                  file: "SRC_POSITION_TEST_MODE"
                  start_line: 39
                }
              }
            }
            src {
              file: "SRC_POSITION_TEST_MODE"
              start_line: 39
            }
          }
        }
        src {
          file: "SRC_POSITION_TEST_MODE"
          start_line: 39
        }
      }
    }
    symbol {
      value: "df2"
    }
    uid: 4
    var_id {
      bitfield1: 4
    }
  }
}
body {
  assign {
    expr {
      sp_session_table_function {
        fn {
          apply_expr {
            fn {
              indirect_table_fn_name_ref {
                name {
                  name {
                    sp_name_structured {
                      name: "my_fn1"
                      name: "my_fn2"
                    }
                  }
                }
              }
            }
            src {
              file: "SRC_POSITION_TEST_MODE"
              start_line: 41
            }
          }
        }
        src {
          file: "SRC_POSITION_TEST_MODE"
          start_line: 41
        }
      }
    }
    symbol {
      value: "df3"
    }
    uid: 5
    var_id {
      bitfield1: 5
    }
  }
}
body {
  assign {
    expr {
      apply_expr {
        fn {
          call_table_function_expr {
            name {
              name {
                sp_name_flat {
                  name: "my_fn1"
                }
              }
            }
          }
        }
        pos_args {
          apply_expr {
            fn {
              builtin_fn {
                name {
                  name {
                    sp_name_flat {
                      name: "lit"
                    }
                  }
                }
              }
            }
            pos_args {
              int64_val {
                src {
                  file: "SRC_POSITION_TEST_MODE"
                  start_line: 44
                }
                v: 1
              }
            }
            src {
              file: "SRC_POSITION_TEST_MODE"
              start_line: 44
            }
          }
        }
        pos_args {
          apply_expr {
            fn {
              builtin_fn {
                name {
                  name {
                    sp_name_flat {
                      name: "lit"
                    }
                  }
                }
              }
            }
            pos_args {
              string_val {
                src {
                  file: "SRC_POSITION_TEST_MODE"
                  start_line: 44
                }
                v: "V"
              }
            }
            src {
              file: "SRC_POSITION_TEST_MODE"
              start_line: 44
            }
          }
        }
        pos_args {
          apply_expr {
            fn {
              builtin_fn {
                name {
                  name {
                    sp_name_flat {
                      name: "lit"
                    }
                  }
                }
              }
            }
            pos_args {
              bool_val {
                src {
                  file: "SRC_POSITION_TEST_MODE"
                  start_line: 44
                }
                v: true
              }
            }
            src {
              file: "SRC_POSITION_TEST_MODE"
              start_line: 44
            }
          }
        }
        src {
          file: "SRC_POSITION_TEST_MODE"
          start_line: 44
        }
      }
    }
    symbol {
    }
    uid: 6
    var_id {
      bitfield1: 6
    }
  }
}
body {
  assign {
    expr {
      sp_session_table_function {
        fn {
          apply_expr {
            fn {
              indirect_table_fn_id_ref {
                id {
                  bitfield1: 6
                }
              }
            }
            src {
              file: "SRC_POSITION_TEST_MODE"
              start_line: 44
            }
          }
        }
        src {
          file: "SRC_POSITION_TEST_MODE"
          start_line: 44
        }
      }
    }
    symbol {
      value: "df4"
    }
    uid: 7
    var_id {
      bitfield1: 7
    }
  }
}
body {
  assign {
    expr {
      apply_expr {
        fn {
          call_table_function_expr {
            name {
              name {
                sp_name_flat {
                  name: "my_fn2"
                }
              }
            }
          }
        }
        pos_args {
          apply_expr {
            fn {
              builtin_fn {
                name {
                  name {
                    sp_name_flat {
                      name: "lit"
                    }
                  }
                }
              }
            }
            pos_args {
              int64_val {
                src {
                  file: "SRC_POSITION_TEST_MODE"
                  start_line: 47
                }
                v: 12
              }
            }
            src {
              file: "SRC_POSITION_TEST_MODE"
              start_line: 47
            }
          }
        }
        src {
          file: "SRC_POSITION_TEST_MODE"
          start_line: 47
        }
      }
    }
    symbol {
    }
    uid: 8
    var_id {
      bitfield1: 8
    }
  }
}
body {
  assign {
    expr {
      sp_session_table_function {
        fn {
          apply_expr {
            fn {
              indirect_table_fn_id_ref {
                id {
                  bitfield1: 8
                }
              }
            }
            src {
              file: "SRC_POSITION_TEST_MODE"
              start_line: 47
            }
          }
        }
        src {
          file: "SRC_POSITION_TEST_MODE"
          start_line: 47
        }
      }
    }
    symbol {
      value: "df5"
    }
    uid: 9
    var_id {
      bitfield1: 9
    }
  }
}
body {
  assign {
    expr {
      apply_expr {
        fn {
          call_table_function_expr {
            name {
              name {
                sp_name_flat {
                  name: "my_fn1"
                }
              }
            }
          }
        }
        pos_args {
          apply_expr {
            fn {
              builtin_fn {
                name {
                  name {
                    sp_name_flat {
                      name: "lit"
                    }
                  }
                }
              }
            }
            pos_args {
              int64_val {
                src {
                  file: "SRC_POSITION_TEST_MODE"
                  start_line: 49
                }
                v: 5
              }
            }
            src {
              file: "SRC_POSITION_TEST_MODE"
              start_line: 49
            }
          }
        }
        pos_args {
          apply_expr {
            fn {
              builtin_fn {
                name {
                  name {
                    sp_name_flat {
                      name: "lit"
                    }
                  }
                }
              }
            }
            pos_args {
              string_val {
                src {
                  file: "SRC_POSITION_TEST_MODE"
                  start_line: 49
                }
                v: "A"
              }
            }
            src {
              file: "SRC_POSITION_TEST_MODE"
              start_line: 49
            }
          }
        }
        pos_args {
          apply_expr {
            fn {
              builtin_fn {
                name {
                  name {
                    sp_name_flat {
                      name: "lit"
                    }
                  }
                }
              }
            }
            pos_args {
              bool_val {
                src {
                  file: "SRC_POSITION_TEST_MODE"
                  start_line: 49
                }
              }
            }
            src {
              file: "SRC_POSITION_TEST_MODE"
              start_line: 49
            }
          }
        }
        src {
          file: "SRC_POSITION_TEST_MODE"
          start_line: 49
        }
      }
    }
    symbol {
    }
    uid: 10
    var_id {
      bitfield1: 10
    }
  }
}
body {
  assign {
    expr {
      sp_session_table_function {
        fn {
          apply_expr {
            fn {
              indirect_table_fn_id_ref {
                id {
                  bitfield1: 10
                }
              }
            }
            src {
              file: "SRC_POSITION_TEST_MODE"
              start_line: 50
            }
          }
        }
        src {
          file: "SRC_POSITION_TEST_MODE"
          start_line: 50
        }
      }
    }
    symbol {
      value: "df6"
    }
    uid: 11
    var_id {
      bitfield1: 11
    }
  }
}
body {
  assign {
    expr {
      apply_expr {
        fn {
          call_table_function_expr {
            name {
              name {
                sp_name_flat {
                  name: "my_fn2"
                }
              }
            }
          }
        }
        src {
          file: "SRC_POSITION_TEST_MODE"
          start_line: 52
        }
      }
    }
    symbol {
    }
    uid: 12
    var_id {
      bitfield1: 12
    }
  }
}
body {
  assign {
    expr {
      sp_session_table_function {
        fn {
          apply_expr {
            fn {
              indirect_table_fn_id_ref {
                id {
                  bitfield1: 12
                }
              }
            }
            src {
              file: "SRC_POSITION_TEST_MODE"
              start_line: 53
            }
          }
        }
        src {
          file: "SRC_POSITION_TEST_MODE"
          start_line: 53
        }
      }
    }
    symbol {
      value: "df7"
    }
    uid: 13
    var_id {
      bitfield1: 13
    }
  }
}
client_ast_version: 1
client_language {
  python_language {
    version {
      label: "final"
      major: 3
      minor: 9
      patch: 1
    }
  }
}
client_version {
  major: 1
  minor: 26
}
